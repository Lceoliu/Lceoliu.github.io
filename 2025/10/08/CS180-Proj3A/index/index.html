

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/lc.jpg">
  <link rel="icon" href="/img/lc.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Chang Leo">
  <meta name="keywords" content="">
  
    <meta name="description" content="CS180 Lab 3 - Part A Overview It&#39;s trivial for us to do several types of geometric transformations: translation, rotation, scaling, skewing, etc. They can all be represented as matrix multiplicati">
<meta property="og:type" content="article">
<meta property="og:title" content="CS180-Proj3A">
<meta property="og:url" content="https://lceoliu.github.io/2025/10/08/CS180-Proj3A/index/index.html">
<meta property="og:site_name" content="Chang&#39;s Blog">
<meta property="og:description" content="CS180 Lab 3 - Part A Overview It&#39;s trivial for us to do several types of geometric transformations: translation, rotation, scaling, skewing, etc. They can all be represented as matrix multiplicati">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/7/79/Hauck_Neue_Constructionen_der_Perspective_fig1a.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180s1.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180s2.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180k1.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180k2.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS1801.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS1802.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bridge_manual_corr.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180manual_kitchen_corr.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180taskA2_correspondences_station.png">
<meta property="og:image" content="https://miro.medium.com/v2/resize:fit:720/format:webp/0*7uAm0FHBq_XmhcxS.jpg">
<meta property="og:image" content="https://miro.medium.com/v2/resize:fit:640/format:webp/0*PJE50me94RGCfC2Z">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180chess_output.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bridge_taskA3_comparison_bilinear.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180kitchen_taskA3_comparison_bilinear.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180station_taskA3_comparison_bilinear.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180taskA4_alpha1_feather.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_bridge.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_bridge.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180k_taskA4_mosaic_feather.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180k_taskA4_mosaic_laplacian2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_match.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_match.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180spherical_result.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180Knight250.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180blue_man.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180blue_man_out.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out_500.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out_300.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out_100_.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out_r07.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out_r11.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180Knight250_descriptors.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180Knight250_patches.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180s1.jpg_s2.jpg_matches.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS1801.jpg_2.jpg_matches.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_match.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180result.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_bridge.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180taskA4_mosaic_laplacian2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180new_kitchen.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180k_taskA4_mosaic_feather.png">
<meta property="article:published_time" content="2025-10-08T23:19:23.000Z">
<meta property="article:modified_time" content="2025-11-13T23:05:28.522Z">
<meta property="article:author" content="Chang Leo">
<meta property="article:tag" content="notes">
<meta property="article:tag" content="CS180">
<meta property="article:tag" content="CV">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/7/79/Hauck_Neue_Constructionen_der_Perspective_fig1a.png">
  
  
  
  <title>CS180-Proj3A - Chang&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"lceoliu.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"9HyUa6m2LMnz9pU9dVwuqyEV-gzGzoHsz","app_key":"LHEhgO1t44IynNOlOy97ZJT1","server_url":null,"path":"window.location.pathname","ignore_local":true},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/node-tikzjax@latest/css/fonts.css" /><style>.tikzjax { display: block; text-align: center; user-select: none; }</style></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav
  id="navbar"
  class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"
>
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Chang</strong>
    </a>

    <button
      id="navbar-toggler-btn"
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
           
        <li class="nav-item">
          <a class="nav-link" href="/">
            <i class="iconfont icon-home-fill"></i> 首页</a
          >
          <!--以上的部分是一级导航的部分-->
          <!--这里判断有没有二级菜单，有的话遍历出二级菜单（就是竖着的那部分）-->
          
        </li>
           
        <li class="nav-item">
          <a class="nav-link" href="/archives/">
            <i class="iconfont icon-archive-fill"></i> 归档</a
          >
          <!--以上的部分是一级导航的部分-->
          <!--这里判断有没有二级菜单，有的话遍历出二级菜单（就是竖着的那部分）-->
          
        </li>
           
        <li class="nav-item">
          <a class="nav-link" href="/categories/">
            <i class="iconfont icon-category-fill"></i> 分类</a
          >
          <!--以上的部分是一级导航的部分-->
          <!--这里判断有没有二级菜单，有的话遍历出二级菜单（就是竖着的那部分）-->
          
          <ul class="sub-menu">
            <!--//遍历出二级菜单（就是竖着的那部分）-->
            
            <li>
              <!--//a标签里当然是输出二级菜单的路径咯-->
              <a href="/categories/Blogs/">
                <!--//i标签里输出二级菜单的icon的class咯-->
                <i class="iconfont icon-category-fill"></i>
                <!--//这里输出二级菜单名咯-->
                Blogs
              </a>
            </li>
            
            <li>
              <!--//a标签里当然是输出二级菜单的路径咯-->
              <a href="/categories/Papers/">
                <!--//i标签里输出二级菜单的icon的class咯-->
                <i class="iconfont icon-category-fill"></i>
                <!--//这里输出二级菜单名咯-->
                Papers
              </a>
            </li>
            
            <li>
              <!--//a标签里当然是输出二级菜单的路径咯-->
              <a href="/categories/Game%20Devs/">
                <!--//i标签里输出二级菜单的icon的class咯-->
                <i class="iconfont icon-category-fill"></i>
                <!--//这里输出二级菜单名咯-->
                Game Devs
              </a>
            </li>
            
          </ul>
          
        </li>
           
        <li class="nav-item">
          <a class="nav-link" href="/tags/">
            <i class="iconfont icon-tags-fill"></i> 标签</a
          >
          <!--以上的部分是一级导航的部分-->
          <!--这里判断有没有二级菜单，有的话遍历出二级菜单（就是竖着的那部分）-->
          
        </li>
           
        <li class="nav-item">
          <a class="nav-link" href="/about/">
            <i class="iconfont icon-user-fill"></i> 关于</a
          >
          <!--以上的部分是一级导航的部分-->
          <!--这里判断有没有二级菜单，有的话遍历出二级菜单（就是竖着的那部分）-->
          
        </li>
           
        <li class="nav-item">
          <a class="nav-link" href="/links/">
            <i class="iconfont icon-link-fill"></i> 友链</a
          >
          <!--以上的部分是一级导航的部分-->
          <!--这里判断有没有二级菜单，有的话遍历出二级菜单（就是竖着的那部分）-->
          
        </li>
         
        <li class="nav-item" id="search-btn">
          <a
            class="nav-link"
            target="_self"
            href="javascript:;"
            data-toggle="modal"
            data-target="#modalSearch"
            aria-label="Search"
          >
            <i class="iconfont icon-search"></i>
          </a>
        </li>
          
        <li class="nav-item" id="color-toggle-btn">
          <a
            class="nav-link"
            target="_self"
            href="javascript:;"
            aria-label="Color Toggle"
          >
            <i class="iconfont icon-dark" id="color-toggle-icon"></i>
          </a>
        </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CS180-Proj3A"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-08 16:19" pubdate>
          2025年10月8日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          695 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          6 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">CS180-Proj3A</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="cs180-lab-3---part-a">CS180 Lab 3 - Part A</h1>
<h2 id="overview">Overview</h2>
<p>It's trivial for us to do several types of geometric transformations:
translation, rotation, scaling, skewing, etc. They can all be
represented as matrix multiplications. However, when we want to stitch
two or more images from different viewpoints together, we need to use a
more general transformation called <strong>homography</strong>.</p>
<h2 id="some-math">Some math</h2>
<h3 id="homography">Homography</h3>
<p>From Wikipedia:</p>
<blockquote>
<p>In the field of computer vision, any two images of the same planar
surface in space are related by a homography (assuming a pinhole camera
model).</p>
</blockquote>
<figure>
<img src="https://upload.wikimedia.org/wikipedia/commons/7/79/Hauck_Neue_Constructionen_der_Perspective_fig1a.png" srcset="/img/loading.gif" lazyload alt="Homography">
<figcaption aria-hidden="true">Homography</figcaption>
</figure>
<p>The homography is a function <span class="math inline">\(h\)</span>
that maps points into points, with the property that if points <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span>, and <span class="math inline">\(z\)</span> are colinear, then the transformed
points <span class="math inline">\(h(x)\)</span>, <span class="math inline">\(h(y)\)</span>, and <span class="math inline">\(h(z)\)</span> are <strong>also colinear</strong>.
So the function <span class="math inline">\(h\)</span> can be
represented as a matrix multiplication:</p>
<p><span class="math display">\[
\begin{bmatrix}
x&#39;/w&#39; \\
y&#39;/w&#39; \\
1
\end{bmatrix}
\longleftrightarrow
\begin{bmatrix}
x&#39; \\
y&#39; \\
w&#39;
\end{bmatrix}
= H \begin{bmatrix}
x \\
y \\
1
\end{bmatrix}
\]</span></p>
<p>where <span class="math inline">\(H\)</span> is a 3x3 matrix, and
<span class="math inline">\((x&#39;, y&#39;, w&#39;)\)</span> are the
transformed coordinates in homogeneous coordinates.</p>
<h3 id="how-to-compute-h">How to compute H?</h3>
<p>First, we suppose H is:</p>
<p><span class="math display">\[
H = \begin{bmatrix}
h_{11} &amp; h_{12} &amp; h_{13} \\
h_{21} &amp; h_{22} &amp; h_{23} \\
h_{31} &amp; h_{32} &amp; h_{33}
\end{bmatrix}
\]</span></p>
<p>Then we assume we have <span class="math inline">\(n\)</span> pairs
of corresponding points <span class="math inline">\((x_i, y_i)\)</span>
and <span class="math inline">\((x&#39;_i, y&#39;_i)\)</span>, where
<span class="math inline">\(i = 1, 2, ..., n\)</span>. Each pair gives
us two equations:</p>
<p><span class="math display">\[
x&#39;_i = \frac{h_{11} x_i + h_{12} y_i + h_{13}}{h_{31} x_i + h_{32}
y_i + h_{33}}
\]</span></p>
<p><span class="math display">\[
y&#39;_i = \frac{h_{21} x_i + h_{22} y_i + h_{23}}{h_{31} x_i + h_{32}
y_i + h_{33}}
\]</span></p>
<p>so we can define <span class="math inline">\(h\)</span> as:</p>
<p><span class="math display">\[h = [h_{11}, h_{12}, h_{13}, h_{21},
h_{22}, h_{23}, h_{31}, h_{32}, h_{33}]^T\]</span></p>
<p>Thus, we can get a system of linear equations <span class="math inline">\(Ah = 0\)</span>, where <span class="math inline">\(A\)</span> is a <span class="math inline">\(2n
\times 9\)</span> matrix below:</p>
<p><span class="math display">\[
A = \begin{bmatrix}
x_1 &amp; y_1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; -x&#39;_1 x_1 &amp;
-x&#39;_1 y_1 &amp; -x&#39;_1 \\
0 &amp; 0 &amp; 0 &amp; x_1 &amp; y_1 &amp; 1 &amp; -y&#39;_1 x_1 &amp;
-y&#39;_1 y_1 &amp; -y&#39;_1 \\
\cdots &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  \\
x_n &amp; y_n &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; -x&#39;_n x_n &amp;
-x&#39;_n y_n &amp; -x&#39;_n \\
0 &amp; 0 &amp; 0 &amp; x_n &amp; y_n &amp; 1 &amp; -y&#39;_n x_n &amp;
-y&#39;_n y_n &amp; -y&#39;_n
\end{bmatrix}
\]</span></p>
<p>And we can solve this by SVD. The solution is the right singular
vector corresponding to the smallest singular value of <span class="math inline">\(A\)</span>. (Finally, we need to reshape <span class="math inline">\(h\)</span> back to a 3x3 matrix <span class="math inline">\(H\)</span>.)</p>
<p>Also, from the above, we can see that we need at least 4 pairs of
corresponding points to solve for <span class="math inline">\(H\)</span>. (every pair gives us 2 equations, and
we have 8 degrees of freedom)</p>
<hr>
<h2 id="a.1-shoot-and-digitize-pictures">A.1 Shoot and Digitize
Pictures</h2>
<p>I prepared three image pairs with large planar overlap:</p>
<ul>
<li>Bridge: the provided OpenCV panorama example for a controlled
baseline (panning around a riverside walkway).</li>
<li>Kitchen: two handheld shots of my kitchen counter taken a few inches
apart while rotating the camera about the optical center.</li>
<li>Table: a tabletop arrangement with books and a monitor, again
acquired by pivoting the camera to keep the motion approximately
projective.</li>
</ul>
<p>Representative inputs are shown below (left/right are the two source
images in each pair):</p>
<p><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180s1.jpg" srcset="/img/loading.gif" lazyload>
<img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180s2.jpg" srcset="/img/loading.gif" lazyload>
<img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180k1.jpg" srcset="/img/loading.gif" lazyload>
<img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180k2.jpg" srcset="/img/loading.gif" lazyload>
<img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS1801.jpg" srcset="/img/loading.gif" lazyload>
<img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS1802.jpg" srcset="/img/loading.gif" lazyload></p>
<h2 id="a.2-recover-homographies">A.2 Recover Homographies</h2>
<p>Correspondences come either from manual clicking (JSON files in
<code>test_data/.../*.json</code>). The correspondence are shown
below:</p>
<ul>
<li><p>Bridge: <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bridge_manual_corr.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>Kitchen: <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180manual_kitchen_corr.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>Station: <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180taskA2_correspondences_station.png" srcset="/img/loading.gif" lazyload></p></li>
</ul>
<p>The estimated homographies are:</p>
<p><span class="math display">\[
H_{bridge} = \begin{bmatrix}
1.000517151994700926e+00 &amp; 1.934651821424284305e-05 &amp;
-4.292858059440893612e+02 \\
-1.347010553204711417e-04 &amp; 1.000425656962335097e+00 &amp;
-1.110208515622688845e-02 \\
-4.040777547417956760e-07 &amp; 9.404293585180129630e-07 &amp;
1.000000000000000000e+00
\end{bmatrix}
\]</span></p>
<p><span class="math display">\[
H_{kitchen} = \begin{bmatrix}
1.383290749963294042e+00 &amp; 3.287087757504674745e-01 &amp;
-4.954696332897179900e+02 \\
-2.480568995413748590e-01 &amp; 1.054769919125850830e+00 &amp;
4.261829110969327417e+02 \\
5.365628407611597794e-04 &amp; -2.587039299089656324e-04 &amp;
1.000000000000000000e+00
\end{bmatrix}
\]</span></p>
<p><span class="math display">\[
H_{station} = \begin{bmatrix}
2.051488129129804605e+00 &amp; -2.166269545193346968e-01 &amp;
-7.714051347860786336e+02 \\
5.373060026078243512e-01 &amp; 1.568850300184745361e+00 &amp;
-3.035902657823175446e+02 \\
1.117455412546467962e-03 &amp; -2.327306688189019295e-04 &amp;
1.000000000000000000e+00
\end{bmatrix}
\]</span></p>
<p>The estimator (<code>utils.py::find_homography</code>)
repeatedly:</p>
<ol type="1">
<li>Samples four correspondences (with degeneracy checks).</li>
<li>Solves a normalized DLT system via SVD.</li>
<li>Scores inliers with a forward reprojection threshold.</li>
<li>Refits the homography on the winning consensus set.</li>
</ol>
<p>All three homographies preserve projective structure well enough for
stitching.</p>
<h2 id="a.3-warp-and-rectify-images">A.3 Warp and Rectify Images</h2>
<h3 id="what-is-inverse-warping">What is Inverse Warping?</h3>
<p>Given a source image <code>im</code> and a homography <code>H</code>
mapping source pixels to target pixels, the goal is to produce a new
image <code>out</code> that shows the source from the target's
perspective. The naive forward mapping approach (looping over every
pixel in <code>im</code>, applying <code>H</code>, and writing to
<code>out</code>) can leave holes because some target pixels may not be
hit. Instead, inverse warping loops over every pixel in
<code>out</code>, applies the inverse homography <code>H^&#123;-1&#125;</code> to
find the corresponding pixel in <code>im</code>, and samples the color
there. This guarantees that every pixel in <code>out</code> is
filled.</p>
<h3 id="nn-vs-bilinear">NN vs Bilinear</h3>
<p>The NN (nearest neighbour) works like this: <img src="https://miro.medium.com/v2/resize:fit:720/format:webp/0*7uAm0FHBq_XmhcxS.jpg" srcset="/img/loading.gif" lazyload></p>
<p>and bilinear interpolation works like this: <img src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*PJE50me94RGCfC2Z" srcset="/img/loading.gif" lazyload></p>
<p>A simple view of NN vs bilinear warping of a chessboard pattern is
shown below:</p>
<p><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180chess_output.png" srcset="/img/loading.gif" lazyload></p>
<p>Obviously bilinear is smoother, but NN is faster and avoids
introducing new colors (which can be helpful for segmentation). I used
bilinear for all final mosaics.</p>
<h3 id="practical-results">Practical Results</h3>
<ul>
<li><p>Bridge: <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bridge_taskA3_comparison_bilinear.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>Kitchen: <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180kitchen_taskA3_comparison_bilinear.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>Station: <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180station_taskA3_comparison_bilinear.png" srcset="/img/loading.gif" lazyload></p></li>
</ul>
<h2 id="a.4-blend-images-into-a-mosaic">A.4 Blend Images into a
Mosaic</h2>
<p>The mosaicer (<code>blend_utils.build_mosaic</code>) projects every
image into a common canvas, warps per-image alpha masks, and blends
either by:</p>
<ul>
<li>Feathering: simple weighted averaging driven by the warped alpha
falloff.</li>
<li>Laplacian (two-level): blur the alphas, blend low/high bands
separately to reduce ghosting.</li>
</ul>
<h3 id="procedure">Procedure</h3>
<ol type="1">
<li><p>Unify the coordinate system and canvas size by projecting all
image corners and finding the bounding box. That is, multiply
<code>H</code> with the four corners, find the final bounding
box.</p></li>
<li><p>Warp each image and its alpha mask into the common canvas using
inverse warping.</p></li>
<li><p>Use a linear falloff alpha mask that is 1 at the center and 0 at
the edges, then warp it to the canvas. Shows like this:</p>
<p><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180taskA4_alpha1_feather.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>Blend the images using either feathering or Laplacian blending.
For Laplacian blending, the low-frequency band is blended with the
blurred alpha masks, and the high-frequency band is blended with the
sharp alpha masks.</p></li>
</ol>
<h3 id="practical-results-1">Practical Results</h3>
<ul>
<li><p>Bridge (feathering): <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_bridge.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>Bridge (Laplacian): <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_bridge.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>Kitchen (feathering): <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180k_taskA4_mosaic_feather.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>Kitchen (Laplacian): <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180k_taskA4_mosaic_laplacian2.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>Station (feathering): <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_match.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>Station (Laplacian): <img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_match.png" srcset="/img/loading.gif" lazyload></p></li>
</ul>
<p>It's obvious that current manual correspondences are not accurate
enough, leading to noticeable artifacts in the blended results. But
don't worry, in Part B we will auto detect and match features to get
better correspondences.</p>
<h2 id="further-thoughts">Further Thoughts</h2>
<ol type="1">
<li>I tried to implement spherical warping. The code refers to an
open-source implementation <a target="_blank" rel="noopener" href="https://github.com/OpenStitching/stitching">here</a>. It works
better on Station image:</li>
</ol>
<p><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180spherical_result.jpg" srcset="/img/loading.gif" lazyload></p>
<ol start="2" type="1">
<li>Plan to implement exposure compensation and multi-band blending in
next project.</li>
</ol>
<h1 id="cs180-lab-3---part-b">CS180 Lab 3 - Part B</h1>
<p>Now no more theory, let's just jump into tasks.</p>
<h2 id="task-1-harris-corner-detection">Task 1: Harris Corner
Detection</h2>
<h4 id="harris-interest-point-detector---single-scale-implemented-with-the-given-sample-code-in-harris.py.">1.
Harris Interest Point Detector - single scale: implemented with the
given sample code in <code>harris.py</code>.</h4>
<p>Results:</p>
<table>

<thead>
<tr>
<th>Input Image</th>
<th>Detected Corners</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180Knight250.png" srcset="/img/loading.gif" lazyload></td>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out.png" srcset="/img/loading.gif" lazyload></td>
</tr>
<tr>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180blue_man.png" srcset="/img/loading.gif" lazyload></td>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180blue_man_out.png" srcset="/img/loading.gif" lazyload></td>
</tr>
</tbody>
</table>
<h4 id="adaptive-non-maximal-suppression-anms">2. Adaptive Non-Maximal
Suppression (ANMS)</h4>
<p>The key idea of ANMS in the paper is to select corners that are both
strong and well-distributed. The algorithm works as follows:</p>
<ol type="1">
<li>Compute the Harris corner response for all pixels in the image. For
each corner point, calculate its minimum suppression radius <span class="math inline">\(r_i\)</span>: <span class="math display">\[r_i =
\min_{j} \{ d_{ij} | h_j &gt; c_{robust} * h_i \}\]</span> where <span class="math inline">\(d_{ij}\)</span> is the Euclidean distance between
corner points <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, <span class="math inline">\(h_i\)</span> and <span class="math inline">\(h_j\)</span> are their Harris corner responses,
and <span class="math inline">\(c_{robust}\)</span> is a robustness
ratio (typically set to 0.9).</li>
<li>Sort the corner points by their suppression radii in descending
order. The bigger the radius, the more isolated and stronger the corner
is.</li>
<li>Select the top N corner points with the largest suppression
radii.</li>
</ol>
<p>Results:</p>
<table>

<thead>
<tr>
<th>Parameters</th>
<th>Detected Corners (ANMS)</th>
</tr>
</thead>
<tbody>
<tr>
<td>N=500, c_robust=0.9</td>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out_500.png" srcset="/img/loading.gif" lazyload></td>
</tr>
<tr>
<td>N=300, c_robust=0.9</td>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out_300.png" srcset="/img/loading.gif" lazyload></td>
</tr>
<tr>
<td>N=100, c_robust=0.9</td>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out_100_.png" srcset="/img/loading.gif" lazyload></td>
</tr>
<tr>
<td>N=500, c_robust=0.7</td>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out_r07.png" srcset="/img/loading.gif" lazyload></td>
</tr>
<tr>
<td>N=500, c_robust=1.1</td>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180knight_out_r11.png" srcset="/img/loading.gif" lazyload></td>
</tr>
</tbody>
</table>
<h2 id="task-2-feature-descriptor">Task 2: Feature Descriptor</h2>
<p>The only thing worth mentioning is to bias/gain-normalize the
descriptor patch. The equations are as follows:</p>
<p><span class="math display">\[I_{norm} = \frac{I - \mu}{\sigma +
\epsilon}\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the mean intensity
of the patch, <span class="math inline">\(\sigma\)</span> is the
standard deviation, and <span class="math inline">\(\epsilon\)</span> is
a small constant (e.g., 1e-10) to prevent division by zero. This
normalization ensures that the descriptor is invariant to changes in
brightness and contrast, making it more robust for matching features
across different images.</p>
<p>So let's just see the results.</p>
<p><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180Knight250_descriptors.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180Knight250_patches.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="task-3-feature-matching">Task 3: Feature Matching</h2>
<p>The main idea of the Lowe's ratio test likes this:</p>
<ol type="1">
<li>For each descriptor in the first image <span class="math inline">\(f_i\)</span>, compute the Euclidean distance to
all descriptors in the second image <span class="math inline">\(g_j\)</span>.</li>
<li>Find the two smallest distances <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span>.</li>
<li>If <span class="math inline">\(d_1 / d_2 &lt;
\text{ratio\_thresh}\)</span>, then we consider the match valid.</li>
</ol>
<p><strong>Why this?</strong></p>
<p>I think the metaphor given by our professor is quite good:</p>
<blockquote>
<p>If you are tangling with two boyfriend candidates and cannot decide
which one is better, that may indicate that neither of them is really
suitable for you. However, if one candidate is clearly better than the
other, then you can be more confident in your choice.</p>
</blockquote>
<p>Results:</p>
<p><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180s1.jpg_s2.jpg_matches.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS1801.jpg_2.jpg_matches.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="task-4-image-stitching-with-ransac">Task 4: Image Stitching with
RANSAC</h2>
<p>This part is already done in Part A. So let's just see the final
results.</p>
<table>

<thead>
<tr>
<th>manual matches</th>
<th>auto matches with feature matching</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_match.png" srcset="/img/loading.gif" lazyload></td>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180result.jpg" srcset="/img/loading.gif" lazyload></td>
</tr>
<tr>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180bad_bridge.png" srcset="/img/loading.gif" lazyload></td>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180taskA4_mosaic_laplacian2.png" srcset="/img/loading.gif" lazyload></td>
</tr>
<tr>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180new_kitchen.png" srcset="/img/loading.gif" lazyload></td>
<td><img src="https://raw.githubusercontent.com/Lceoliu/blog-img/main/CS180k_taskA4_mosaic_feather.png" srcset="/img/loading.gif" lazyload></td>
</tr>
</tbody>
</table>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/notes/" class="print-no-link">#notes</a>
      
        <a href="/tags/CS180/" class="print-no-link">#CS180</a>
      
        <a href="/tags/CV/" class="print-no-link">#CV</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CS180-Proj3A</div>
      <div>https://lceoliu.github.io/2025/10/08/CS180-Proj3A/index/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Chang Leo</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月8日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/11/13/CS180-Proj4-NeRF/" title="CS180-Proj4-NeRF">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CS180-Proj4-NeRF</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/05/27/group_meeting/group_meeting/" title="组会报告汇总">
                        <span class="hidden-mobile">组会报告汇总</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"9HyUa6m2LMnz9pU9dVwuqyEV-gzGzoHsz","appKey":"LHEhgO1t44IynNOlOy97ZJT1","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/Lceoliu" target="_blank" rel="nofollow noopener"><span>My Github</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
